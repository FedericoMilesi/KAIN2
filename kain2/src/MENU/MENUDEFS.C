#include "CORE.H"
#include "MENUDEFS.H"
#include "MENU/MENU.H"
#include "GAMELOOP.H"
#include "PSX/MAIN.H"
#include "LOCAL/LOCALSTR.H"
#include "FONT.H"

int StartGameFading;
int LINESKIP = 14; // offset 0x800d1fa8
int ITEMSKIP = 2; // offset 0x800d1fac
int hack_reset_attract;
int hack_attract;
int hack_attract_movie;
char* the_attract_movies[4] = { "\\KAINDEM1.STR;1", "\\KAINDEM2.STR;1", "\\KAINDEM3.STR;1", "\\KAINDEM4.STR;1" };

// autogenerated function stub: 
// void /*$ra*/ do_check_controller(void *gt /*$a0*/)
void do_check_controller(void *gt)
{ // line 164, offset 0x800b8938
	/* begin block 1 */
		// Start line: 328
	/* end block 1 */
	// End Line: 329

}


// autogenerated function stub: 
// int /*$ra*/ do_push_menu(void *gt /*$a0*/, long menuparam /*$a1*/, enum menu_ctrl_t ctrl /*$a2*/)
int do_push_menu(void *gt, long menuparam, enum menu_ctrl_t ctrl)
{ // line 180, offset 0x800b896c
	/* begin block 1 */
		// Start line: 181
		// Start offset: 0x800B896C
	/* end block 1 */
	// End offset: 0x800B8994
	// End Line: 194

	/* begin block 2 */
		// Start line: 360
	/* end block 2 */
	// End Line: 361

	return 0;
}


// autogenerated function stub: 
// int /*$ra*/ do_pop_menu(void *gt /*$a0*/, long param /*$a1*/, enum menu_ctrl_t ctrl /*$a2*/)
int do_pop_menu(void *gt, long param, enum menu_ctrl_t ctrl)
{ // line 196, offset 0x800b89a4
	/* begin block 1 */
		// Start line: 401
	/* end block 1 */
	// End Line: 402

	return 0;
}


// autogenerated function stub: 
// int /*$ra*/ do_function(void *gt /*$a0*/, long fnparam /*$a1*/, enum menu_ctrl_t ctrl /*$a2*/)
int do_function(void *gt, long fnparam, enum menu_ctrl_t ctrl)
{ // line 207, offset 0x800b89dc
	/* begin block 1 */
		// Start line: 420
	/* end block 1 */
	// End Line: 421

	/* begin block 2 */
		// Start line: 426
	/* end block 2 */
	// End Line: 427

	return 0;
}


// autogenerated function stub: 
// int /*$ra*/ do_start_game(void *gt /*$s0*/, long parameter /*$a1*/, enum menu_ctrl_t ctrl /*$a2*/)
int do_start_game(void *gt, long parameter, enum menu_ctrl_t ctrl)
{ // line 221, offset 0x800b8a10
	/* begin block 1 */
		// Start line: 448
	/* end block 1 */
	// End Line: 449

	/* begin block 2 */
		// Start line: 457
	/* end block 2 */
	// End Line: 458

	return 0;
}


// autogenerated function stub: 
// int /*$ra*/ do_save_menu(void *gt /*$a0*/, long parameter /*$a1*/, enum menu_ctrl_t ctrl /*$a2*/)
int do_save_menu(void *gt, long parameter, enum menu_ctrl_t ctrl)
{ // line 250, offset 0x800b8a74
	/* begin block 1 */
		// Start line: 515
	/* end block 1 */
	// End Line: 516

	return 0;
}


// autogenerated function stub: 
// void /*$ra*/ womp_background(char *tim_path /*$s0*/)
void womp_background(char *tim_path)
{ // line 277, offset 0x800b8ab0
	/* begin block 1 */
		// Start line: 553
	/* end block 1 */
	// End Line: 554

	/* begin block 2 */
		// Start line: 573
	/* end block 2 */
	// End Line: 574

}


// autogenerated function stub: 
// void /*$ra*/ play_movie(char *name /*$s0*/)
#if !defined(PSX_VERSION)
void play_movie(char *name)
{ // line 291, offset 0x800b8ae8
	/* begin block 1 */
		// Start line: 292
		// Start offset: 0x800B8AE8
	/* end block 1 */
	// End offset: 0x800B8B20
	// End Line: 311

	/* begin block 2 */
		// Start line: 608
	/* end block 2 */
	// End Line: 609

}
#endif


// autogenerated function stub: 
// void /*$ra*/ menudefs_reset_hack_attract_mode()
void menudefs_reset_hack_attract_mode()
{ // line 331, offset 0x800b8b30
	/* begin block 1 */
		// Start line: 688
	/* end block 1 */
	// End Line: 689

	/* begin block 2 */
		// Start line: 689
	/* end block 2 */
	// End Line: 690

}

void check_hack_attract()
{
	if (hack_attract > 0)
	{
		if (hack_attract + 2000 < gameTrackerX.vblCount)
		{
			hack_attract = 1;
			play_movie(the_attract_movies[hack_attract_movie += 1 & 3]);
			hack_attract = gameTrackerX.vblCount;
		}
	}
}


// autogenerated function stub: 
// int /*$ra*/ get_volume(void *gt /*$a0*/, enum sfx_t sfx /*$a1*/)
int get_volume(void *gt, enum sfx_t sfx)
{ // line 377, offset 0x800b8bc4
	/* begin block 1 */
		// Start line: 379
		// Start offset: 0x800B8BC4
		// Variables:
			int raw; // $a2
	/* end block 1 */
	// End offset: 0x800B8C00
	// End Line: 385

	/* begin block 2 */
		// Start line: 784
	/* end block 2 */
	// End Line: 785

	/* begin block 3 */
		// Start line: 785
	/* end block 3 */
	// End Line: 786

	/* begin block 4 */
		// Start line: 786
	/* end block 4 */
	// End Line: 787

	return 0;
}


// autogenerated function stub: 
// void /*$ra*/ set_volume(enum sfx_t sfx /*$a2*/, int cooked /*$a1*/)
void set_volume(enum sfx_t sfx, int cooked)
{ // line 388, offset 0x800b8c30
	/* begin block 1 */
		// Start line: 389
		// Start offset: 0x800B8C30
		// Variables:
			int raw; // $a0
	/* end block 1 */
	// End offset: 0x800B8CAC
	// End Line: 397

	/* begin block 2 */
		// Start line: 806
	/* end block 2 */
	// End Line: 807

	/* begin block 3 */
		// Start line: 807
	/* end block 3 */
	// End Line: 808

}


// autogenerated function stub: 
// int /*$ra*/ do_sound_adjust(void *gt /*$a0*/, long sfxparam /*$s0*/, enum menu_ctrl_t ctrl /*$s1*/)
int do_sound_adjust(void *gt, long sfxparam, enum menu_ctrl_t ctrl)
{ // line 399, offset 0x800b8cbc
	/* begin block 1 */
		// Start line: 400
		// Start offset: 0x800B8CBC
		// Variables:
			int volume; // $a1
	/* end block 1 */
	// End offset: 0x800B8D24
	// End Line: 420

	/* begin block 2 */
		// Start line: 829
	/* end block 2 */
	// End Line: 830

	return 0;
}


// autogenerated function stub: 
// void /*$ra*/ sound_item(void *gt /*$s0*/, char *text /*$s2*/, enum sfx_t sfx /*$s1*/)
void sound_item(void *gt, char *text, enum sfx_t sfx)
{ // line 422, offset 0x800b8d38
	/* begin block 1 */
		// Start line: 423
		// Start offset: 0x800B8D38
	/* end block 1 */
	// End offset: 0x800B8D38
	// End Line: 423

	/* begin block 2 */
		// Start line: 875
	/* end block 2 */
	// End Line: 876

}


// autogenerated function stub: 
// int /*$ra*/ menudefs_toggle_dualshock(void *gt /*$a0*/, long param /*$a1*/, enum menu_ctrl_t ctrl /*$a2*/)
int menudefs_toggle_dualshock(void *gt, long param, enum menu_ctrl_t ctrl)
{ // line 1048, offset 0x800b8d9c
	/* begin block 1 */
		// Start line: 2127
	/* end block 1 */
	// End Line: 2128

	return 0;
}


// autogenerated function stub: 
// int /*$ra*/ options_menu(void *gt /*$s1*/, int index /*$s2*/)
int options_menu(void *gt, int index)
{ // line 1066, offset 0x800b8e00
	/* begin block 1 */
		// Start line: 1067
		// Start offset: 0x800B8E00
		// Variables:
			static int wasDualShock; // offset 0x0
			int dualShock; // $s0
	/* end block 1 */
	// End offset: 0x800B8F30
	// End Line: 1128

	/* begin block 2 */
		// Start line: 2163
	/* end block 2 */
	// End Line: 2164

	return 0;
}


// autogenerated function stub: 
// int /*$ra*/ main_menu(void *gt /*$s0*/, int index /*$s1*/)
int main_menu(void *gt, int index)
{ // line 1145, offset 0x800b8f48
	/* begin block 1 */
		// Start line: 2321
	/* end block 1 */
	// End Line: 2322

	return 0;
}

int do_main_menu(void *gt, long param, enum menu_ctrl_t ctrl)
{ 
	if (StartGameFading == 0 && ctrl == menu_ctrl_start || ctrl == menu_ctrl_engage)
	{
		((GameTracker*)gt)->wipeType = 10;
		((GameTracker*)gt)->wipeTime = -14;
		((GameTracker*)gt)->maxWipeTime = 20;
		StartGameFading = 1;
		return 1;
	}
	
	return 0;
}

char* flashStart()
{ 
	static int counter = -1;
	int intpl;
	int fcols[2][3] = { 0xC0, 0xD2, 0xD2, 0xC0, 0xC0, 0x40 };
	int r;
	int g;
	int b;

	gameTrackerX.gameFramePassed = 1;

	if (StartGameFading == 1)
	{
		hack_reset_attract = 1;

		if (gameTrackerX.wipeTime == -1)
		{
			womp_background("\\kain2\\game\\psx\\bkgdmenu.tim");
			
			gameTrackerX.wipeType = 10;
			gameTrackerX.wipeTime = 20;
			gameTrackerX.maxWipeTime = 20;
			
			StartGameFading = 0;

			menu_pop(gameTrackerX.menu);
			menu_push(gameTrackerX.menu, main_menu);

			return NULL;
		}
	}
	else
	{
		counter = (counter + 1) % 60;
		
		if (counter < 10)
		{
			intpl = 0;
		}
		else if (counter < 30)
		{
			intpl = ((((counter - 10) << 12) * 0x66666667) >> 3) - (((counter - 10) << 12) >> 31);
		}
		else
		{
			if (counter < 40)
			{
				intpl = 4096;
			}
			else
			{
				intpl = ((((60 - counter) << 12) * 0x66666667) >> 3) - (((60 - counter) << 12) >> 31);
			}
		}

		r = ((fcols[0][0] * (4096 - counter)) + (fcols[1][0] * (counter))) >> 12;
		g = ((fcols[0][1] * (4096)) + (fcols[1][1] * (counter))) >> 12;
		b = ((fcols[0][2] * (4096)) + (fcols[1][2] * (counter))) >> 12;

		FONT_SetColorIndex(4);
		FONT_SetColorIndexCol(4, r, g, b);
	}

	return localstr_get(LOCALSTR_press_start);
}

int menudefs_main_menu(void *gt, int index)
{ 
	if (hack_reset_attract != 0)
	{
		hack_reset_attract = 0;
		hack_attract = gameTrackerX.vblCount;
	}

	check_hack_attract();
	menu_format(((GameTracker*)gt)->menu, 1, 366, 144, 100, LINESKIP, ITEMSKIP, 0);
	menu_item(((GameTracker*)gt)->menu, do_main_menu, 0, flashStart());

	if (index >= 0)
	{
		return index;
	}

	return 0;
}


// autogenerated function stub: 
// int /*$ra*/ menudefs_confirmexit_menu(void *gt /*$s0*/, int index /*$s1*/)
int menudefs_confirmexit_menu(void *gt, int index)
{ // line 1283, offset 0x800b934c
	/* begin block 1 */
		// Start line: 2619
	/* end block 1 */
	// End Line: 2620

	return 0;
}


// autogenerated function stub: 
// int /*$ra*/ menudefs_pause_menu(void *gt /*$s1*/, int index /*$s2*/)
int menudefs_pause_menu(void *gt, int index)
{ // line 1294, offset 0x800b93f4
	/* begin block 1 */
		// Start line: 2641
	/* end block 1 */
	// End Line: 2642

	return 0;
}




