#include "CORE.H"
#include "MENU.H"

int menu_data_size()
{ 
	return 904;
}

void menu_initialize(struct menu_t *menu, void *opaque)
{ 
	memset(menu, 0, sizeof(menu_t));

	menu->nmenus = -1;
	menu->opaque = opaque;
}

void menu_format(struct menu_t *menu, int center, int xpos, int ypos, int width, int lineskip, int itemskip, int border)
{
	struct menu_format_t* fmt;

	fmt = &menu[menu->nmenus].stack[0].format;
	
	fmt += 2;

	fmt->ypos = ypos;
	fmt->center = center;
	fmt->lineskip = lineskip;
	fmt->itemskip = itemskip;
	fmt->width = width;
	fmt->border = border;
}

void menu_set(struct menu_t *menu, int fn(void*, int))
{ 
	menu->nmenus = 0;
	menu->drawfn = NULL;
	menu_push(menu, fn);
}

void menu_push(struct menu_t *menu, int fn(void*, int))
{ 
	struct menu_stack_t *stack;

	stack = &menu->stack[menu->nmenus++];

	stack->fn = fn;
	stack->index = -1;
	stack->format = (stack - 1)->format;
}


// autogenerated function stub: 
// void /*$ra*/ menu_pop(struct menu_t *menu /*$a0*/)
void menu_pop(struct menu_t *menu)
{ // line 134, offset 0x800b7b70
	/* begin block 1 */
		// Start line: 279
	/* end block 1 */
	// End Line: 280

	/* begin block 2 */
		// Start line: 281
	/* end block 2 */
	// End Line: 282

}


// autogenerated function stub: 
// void /*$ra*/ menu_item_flags(struct menu_t *menu /*$s2*/, TDRFuncPtr_menu_item_flags1fn fn /*$a1*/, long parameter /*$a2*/, long flags /*$a3*/, char *format /*stack 16*/)
void menu_item_flags(struct menu_t *menu, TDRFuncPtr_menu_item_flags1fn fn, long parameter, long flags, char *format)
{ // line 152, offset 0x800b7b84
	/* begin block 1 */
		// Start line: 153
		// Start offset: 0x800B7B84

		/* begin block 1.1 */
			// Start line: 153
			// Start offset: 0x800B7B84
			// Variables:
				struct menu_item_t *item; // $s1
		/* end block 1.1 */
		// End offset: 0x800B7B84
		// End Line: 153
	/* end block 1 */
	// End offset: 0x800B7B84
	// End Line: 153

	/* begin block 2 */
		// Start line: 304
	/* end block 2 */
	// End Line: 305

}


// autogenerated function stub: 
// void /*$ra*/ menu_item(struct menu_t *menu /*$s2*/, TDRFuncPtr_menu_item1fn fn /*$a1*/, long parameter /*$a2*/, char *format /*stack 12*/)
void menu_item(struct menu_t *menu, int (*fn)(void*, long, enum menu_ctrl_t), long parameter, char* format)
{ // line 170, offset 0x800b7c14
	/* begin block 1 */
		// Start line: 171
		// Start offset: 0x800B7C14

		/* begin block 1.1 */
			// Start line: 171
			// Start offset: 0x800B7C14
			// Variables:
				struct menu_item_t *item; // $s1

			/* begin block 1.1.1 */
				// Start line: 181
				// Start offset: 0x800B7C74
			/* end block 1.1.1 */
			// End offset: 0x800B7C74
			// End Line: 183
		/* end block 1.1 */
		// End offset: 0x800B7CA0
		// End Line: 192
	/* end block 1 */
	// End offset: 0x800B7CA0
	// End Line: 193

	/* begin block 2 */
		// Start line: 344
	/* end block 2 */
	// End Line: 345

}

void menu_build(struct menu_t *menu)
{ 
	struct menu_stack_t *stack;
	
	menu->nitems = 0;
	menu->nbytes = 0;

	stack = &menu->stack[menu->nmenus - 1];

	stack->index = stack->fn(menu->opaque, (stack - 1)->index);
}


// autogenerated function stub: 
// void /*$ra*/ DisplayHintBox(int len /*$a0*/, int y /*$a1*/)
void DisplayHintBox(int len, int y)
{ // line 221, offset 0x800b7d10
	/* begin block 1 */
		// Start line: 222
		// Start offset: 0x800B7D10
		// Variables:
			//struct Extents2d ext; // stack offset -24
			int i; // $s0

		/* begin block 1.1 */
			// Start line: 239
			// Start offset: 0x800B7D48
		/* end block 1.1 */
		// End offset: 0x800B7D48
		// End Line: 239
	/* end block 1 */
	// End offset: 0x800B7E2C
	// End Line: 255

	/* begin block 2 */
		// Start line: 458
	/* end block 2 */
	// End Line: 459

}


// autogenerated function stub: 
// void /*$ra*/ DisplayMenuBox(int x0 /*$a0*/, int x1 /*$a1*/, int y0 /*$a2*/, int y1 /*$a3*/)
void DisplayMenuBox(int x0, int x1, int y0, int y1)
{ // line 257, offset 0x800b7e3c
	/* begin block 1 */
		// Start line: 258
		// Start offset: 0x800B7E3C
		// Variables:
			//struct Extents2d ext; // stack offset -56
			static int dy[16]; // offset 0x0
			int i; // $s3
			int j; // $s6
			int k; // $s2
			int slice0; // $s7
			unsigned long **ot; // $s5
			struct _PrimPool *primPool; // $s4

		/* begin block 1.1 */
			// Start line: 276
			// Start offset: 0x800B7ED4

			/* begin block 1.1.1 */
				// Start line: 278
				// Start offset: 0x800B7EE4
			/* end block 1.1.1 */
			// End offset: 0x800B7EE4
			// End Line: 278
		/* end block 1.1 */
		// End offset: 0x800B7FDC
		// End Line: 290
	/* end block 1 */
	// End offset: 0x800B8044
	// End Line: 300

	/* begin block 2 */
		// Start line: 552
	/* end block 2 */
	// End Line: 553

}


// autogenerated function stub: 
// int /*$ra*/ menu_draw_item(struct menu_t *menu /*$a0*/, int ypos /*stack 4*/, int xadj /*stack 8*/, int yadj /*$a3*/, char *text /*stack 16*/, int color /*stack 20*/, long flags /*stack 24*/, struct Extents2d *e /*stack 28*/)
int menu_draw_item(struct menu_t *menu, int ypos, int xadj, int yadj, char *text, int color, long flags, struct Extents2d *e)
{ // line 311, offset 0x800b8074
	/* begin block 1 */
		// Start line: 312
		// Start offset: 0x800B8074
		// Variables:
			struct menu_format_t *fmt; // stack offset -64
			int numColumns; // $a1
			int i; // $v1
			int texLen; // $a0
			int columnWidth; // $fp
			char *columnText; // $a1
			char tmpBuff[256]; // stack offset -320
			char *lineText; // $s1
			int columnYPos; // $s5
			int maxColumnYPos; // stack offset -60
			int center; // stack offset -56
			int leftEdge; // stack offset -52
			int xpos; // $s4

		/* begin block 1.1 */
			// Start line: 403
			// Start offset: 0x800B823C
			// Variables:
				char *eol; // $s6

			/* begin block 1.1.1 */
				// Start line: 410
				// Start offset: 0x800B8260
				// Variables:
					char *eop; // $s2

				/* begin block 1.1.1.1 */
					// Start line: 412
					// Start offset: 0x800B8278
					// Variables:
						char *tmp; // $s0
						int wd; // $v0
				/* end block 1.1.1.1 */
				// End offset: 0x800B82B8
				// End Line: 427

				/* begin block 1.1.1.2 */
					// Start line: 434
					// Start offset: 0x800B82E0
				/* end block 1.1.1.2 */
				// End offset: 0x800B8320
				// End Line: 440

				/* begin block 1.1.1.3 */
					// Start line: 443
					// Start offset: 0x800B8328
					// Variables:
						//int wd; // $s0
				/* end block 1.1.1.3 */
				// End offset: 0x800B8378
				// End Line: 450
			/* end block 1.1.1 */
			// End offset: 0x800B838C
			// End Line: 453
		/* end block 1.1 */
		// End offset: 0x800B83A4
		// End Line: 457
	/* end block 1 */
	// End offset: 0x800B8444
	// End Line: 478

	/* begin block 2 */
		// Start line: 733
	/* end block 2 */
	// End Line: 734

	return 0;
}

void menu_draw(struct menu_t *menu)
{
	struct Extents2d ext;
	struct menu_stack_t* stack;
	int index;
	int ypos;
	int i;
	struct menu_item_t* item;
	int color;

	ext.xmin = -129;
	ext.xmax = 2147483648;
	ext.ymin = -129;
	ext.ymax = 2147483648;

	stack = &menu[menu->nmenus-1].stack[2];
	index = stack->index;
	ypos = 0;
	
	if (stack->index != 0)
	{
		menu[menu->nmenus - 1].drawfn(menu->opaque);
	}

	if (menu->nitems > 0)
	{
		do
		{
			item = &menu->items[i];
			
			if (i == 0 && !(item->flags & 0x4))
			{
				color = 3;
			}
			else
			{
				color = 0 < (i ^ index);
			}

			ypos = menu_draw_item(menu, ypos, 0, 0, item->text, color, item->flags, &ext);
	
		} while (i < menu->nitems);
	}

	if (stack->format.border != 0)
	{
		DisplayMenuBox(ext.xmin, ext.xmax, ext.ymin, ext.ymax);
	}
}


// autogenerated function stub: 
// void /*$ra*/ menu_run(struct menu_t *menu /*$s2*/)
void menu_run(struct menu_t *menu)
{ // line 524, offset 0x800b85d8
	/* begin block 1 */
		// Start line: 525
		// Start offset: 0x800B85D8
		// Variables:
			enum menu_ctrl_t ctrl; // $s1
			struct menu_stack_t *stack; // $s4
			int index; // $s0
			struct menu_item_t *item; // $s3

		/* begin block 1.1 */
			// Start line: 546
			// Start offset: 0x800B8640
			// Variables:
				enum menu_sound_t sound; // $v0
		/* end block 1.1 */
		// End offset: 0x800B8674
		// End Line: 559
	/* end block 1 */
	// End offset: 0x800B87A8
	// End Line: 588

	/* begin block 2 */
		// Start line: 1239
	/* end block 2 */
	// End Line: 1240

}

void menu_process(struct menu_t *menu)
{ 
	menu_build(menu);
	menu_draw(menu);
	menu_run(menu);
}




