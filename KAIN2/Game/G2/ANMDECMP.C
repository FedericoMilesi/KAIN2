#include "../core.H"
#include "ANMDECMP.H"

DWORD dword_4F4AA0[] =
{
	0xFFFFFFFF, 0xFFFFFFFE, 0xFFFFFFFF, 0xFFFFFFFF, 1, 2, 4, 7,
	0xFFFFFFFF, 0xFFFFFFFE, 0xFFFFFFFF, 0xFFFFFFFF, 1, 2, 4, 7
};

WORD word_4F4AE0[] =
{
	7,   0, 8,   0, 9,   0, 10,  0, 11,  0, 12,  0, 13,  0, 14,  0,
	16,  0, 18,  0, 20,  0, 22,  0, 24,  0, 26,  0, 29,  0, 32,  0,
	35,  0, 38,  0, 41,  0, 45,  0, 49,  0, 53,  0, 57,  0, 62,  0,
	67,  0, 72,  0, 79,  0, 85,  0, 91,  0, 97,  0, 104, 0, 111, 0,
	118, 0, 126, 0, 107, 0, 115, 0, 124, 0, 133, 0, 142, 0, 152, 0,
	162, 0, 173, 0, 184, 0, 196, 0, 208, 0, 221, 0, 234, 0, 248, 0,
	262, 0, 277, 0, 293, 0, 309, 0, 326, 0, 343, 0, 361, 0, 380, 0,
	400, 0, 421, 0, 443, 0, 466, 0, 491, 0, 518, 0, 547, 0, 579, 0
};

// autogenerated function stub: 
// void /*$ra*/ _G2Anim_DecompressChannel_AdaptiveDelta(struct _G2AnimDecompressChannelInfo_Type *dcInfo /*$a0*/, struct _G2AnimChanStatus_Type *status /*$a1*/)
void _G2Anim_DecompressChannel_AdaptiveDelta(struct _G2AnimDecompressChannelInfo_Type *dcInfo, struct _G2AnimChanStatus_Type *status)
{ // line 135, offset 0x800900f4
#if defined(PSX_VERSION)
	UNIMPLEMENTED();
#elif defined(PC_VERSION)
	struct _G2AnimChanStatus_Type* v2; // ebx
	struct _G2AnimDecompressChannelInfo_Type* v3; // edi
	int storedKey; // edx
	u_short* v5; // eax
	int v6; // ecx
	int index; // esi
	unsigned __int16 v8; // bp
	unsigned __int16 v9; // ax
	unsigned __int16 v10; // cx
	int v11; // eax
	int keyData; // [esp+14h] [ebp-10h]

	v2 = status;
	v3 = dcInfo;
	storedKey = dcInfo->storedKey;
	v5 = dcInfo->chanData + 2;
	v6 = dcInfo->keylist->keyCount + 3;
	keyData = status->keyData;
	index = status->index;
	if (storedKey < dcInfo->targetKey)
	{
		while (1)
		{
			++storedKey;
			v8 = word_4F4AE0[2 * index];
			v9 = (v5[storedKey >> 2] >> (4 * (storedKey & 3))) & 0xF;
			index += dword_4F4AA0[v9];
			if (index < 0)
				index = 0;
			if (index > 63)
				index = 63;
			v10 = v8 >> 3;
			if ((v9 & 4) != 0)
				v10 += v8;
			if ((v9 & 2) != 0)
				v10 += v8 >> 1;
			if ((v9 & 1) != 0)
				v10 += (v8 >> 2) + (v8 & 1);
			v11 = (v9 & 8) != 0 ? keyData - v10 : v10 + keyData;
			keyData = v11;
			if (storedKey >= dcInfo->targetKey)
				break;
			v5 = dcInfo->chanData + 2;
		}
		v2 = status;
		v6 = dcInfo->keylist->keyCount + 3;
		v5 = dcInfo->chanData + 2;
		v3 = dcInfo;
	}
	v2->index = index;
	v2->keyData = keyData;
	v3->chanData = &v5[v6 >> 2];
#endif
}


// autogenerated function stub: 
// void /*$ra*/ _G2Anim_DecompressChannel_Linear(struct _G2AnimDecompressChannelInfo_Type *dcInfo /*$a0*/, struct _G2AnimChanStatus_Type *status /*$a1*/)
void _G2Anim_DecompressChannel_Linear(struct _G2AnimDecompressChannelInfo_Type *dcInfo, struct _G2AnimChanStatus_Type *status)
{ // line 198, offset 0x80090220
	/* begin block 1 */
		// Start line: 201
		// Start offset: 0x80090220
		// Variables:
			unsigned short *chanData; // $a2
			short rangeBase; // $t0
			short rangeInfo; // $v0
			int rangeLength; // $v1
			int rangeOffset; // $a0
			int targetKey; // $a3
	/* end block 1 */
	// End offset: 0x80090288
	// End Line: 232

	/* begin block 2 */
		// Start line: 412
	/* end block 2 */
	// End Line: 413

	/* begin block 3 */
		// Start line: 414
	/* end block 3 */
	// End Line: 415

	/* begin block 4 */
		// Start line: 423
	/* end block 4 */
	// End Line: 424
	UNIMPLEMENTED();
}


// autogenerated function stub: 
// void /*$ra*/ _G2Anim_InitializeChannel_AdaptiveDelta(struct _G2AnimDecompressChannelInfo_Type *dcInfo /*$a0*/, struct _G2AnimChanStatus_Type *status /*$a1*/)
void _G2Anim_InitializeChannel_AdaptiveDelta(struct _G2AnimDecompressChannelInfo_Type *dcInfo, struct _G2AnimChanStatus_Type *status)
{ // line 271, offset 0x800902b4
#if defined(PSX_VERSION)
	UNIMPLEMENTED();
#elif defined(PC_VERSION)
	u_short* chanData; // eax
	int v3; // ecx

	chanData = dcInfo->chanData;
	v3 = (dcInfo->keylist->keyCount + 3) >> 2;
	status->index = *(unsigned __int8*)chanData;
	status->keyData = chanData[1];
	dcInfo->chanData = &chanData[v3 + 2];
#endif
}


// autogenerated function stub: 
// void /*$ra*/ _G2Anim_InitializeChannel_Linear(struct _G2AnimDecompressChannelInfo_Type *dcInfo /*$a0*/, struct _G2AnimChanStatus_Type *status /*$a1*/)
void _G2Anim_InitializeChannel_Linear(struct _G2AnimDecompressChannelInfo_Type *dcInfo, struct _G2AnimChanStatus_Type *status)
{ // line 289, offset 0x800902ec
#if defined(PSX_VERSION)
	UNIMPLEMENTED();
#elif defined(PC_VERSION)
	u_short* chanData; // ecx
	int v3; // eax

	chanData = dcInfo->chanData;
	v3 = *chanData & 0xFFF;
	status->keyData = chanData[1];
	dcInfo->chanData = &chanData[v3 + 1];
#endif
}
