#include "Game/CORE.H"
#include "ALGOCTRL.H"
#include "Game/INSTANCE.H"
#include "Game/STATE.H"
#include "Game/G2/ANMCTRLR.H"
#include "Game/G2/QUATG2.H"

static int AlgoControlFlag;

void InitAlgorithmicWings(struct _Instance* instance) // Matching - 99.51%
{
	struct _G2EulerAngles_Type Rot;
	unsigned char i;

	if ((AlgoControlFlag & 1) == 0)
	{
		if (instance->matrix == NULL)
		{
			INSTANCE_Post(instance, 0x100006, 0);
		}
		else
		{
			for (i = 51; i < 54; i++)
			{
				if (instance->matrix == NULL)
				{
					Rot.z = 0;
					Rot.y = 0;
					Rot.x = 0;
				}
				else
				{
					G2EulerAngles_FromMatrix(&Rot, &(instance->anim).segMatrices[i - 1], 0x15);
				}

				G2Anim_EnableController(&instance->anim, i, 8);
				G2EmulationSetInterpController_Vector(instance, i, 8, (struct _G2SVector3_Type*)&Rot, (i - 50) * 3, 2);
			}

			for (i = 59; i < 62; i++)
			{
				if (instance->matrix == NULL)
				{
					Rot.z = 0;
					Rot.y = 0;
					Rot.x = 0;
				}
				else
				{
					G2EulerAngles_FromMatrix(&Rot, &(instance->anim).segMatrices[i - 1], 0x15);
				}

				G2Anim_EnableController(&instance->anim, i, 8);
				G2EmulationSetInterpController_Vector(instance, i, 8, (struct _G2SVector3_Type*)&Rot, (i - 58) * 3, 2);
			}

			AlgoControlFlag |= 1;
		}
	}
}

void DeInitAlgorithmicWings(struct _Instance* instance) // Matching - 100%
{
	unsigned char i;

	if ((AlgoControlFlag & 1))
	{
		for (i = 51; i < 54; i++)
		{
			G2Anim_DisableController(&instance->anim, i, 8);
		}

		for (i = 59; i < 62; i++)
		{
			G2Anim_DisableController(&instance->anim, i, 8);
		}

		AlgoControlFlag &= ~0x1;
	}
}

void AlgorithmicWings(struct _Instance* instance, struct evAnimationControllerDoneData* ControllerData) // Matching - 81.50%
{
	struct _G2EulerAngles_Type Rot;

	G2EulerAngles_FromMatrix(&Rot, &instance->anim.segMatrices[ControllerData->segment - 1], 0x15);
	G2EmulationSetInterpController_Vector(instance, ControllerData->segment, ControllerData->type, (struct _G2SVector3_Type*)&Rot, 5, 2);
}

// autogenerated function stub: 
// void /*$ra*/ AlgorithmicNeck(struct _Instance *Player /*$s1*/, struct _Instance *Target /*$s2*/)
void AlgorithmicNeck(struct _Instance *Player, struct _Instance *Target)
{ // line 150, offset 0x800a1ebc
	/* begin block 1 */
		// Start line: 151
		// Start offset: 0x800A1EBC
		// Variables:
			_Position From; // stack offset -96
			_Position To; // stack offset -88
			struct _Rotation Rot1; // stack offset -80
			int Diff; // $v1
			MATRIX matrix; // stack offset -72

		/* begin block 1.1 */
			// Start line: 162
			// Start offset: 0x800A1EF0
			// Variables:
				struct evCollideInstanceStatsData data; // stack offset -40
		/* end block 1.1 */
		// End offset: 0x800A1F58
		// End Line: 183

		/* begin block 1.2 */
			// Start line: 208
			// Start offset: 0x800A1FFC
			// Variables:
				//MATRIX *matrix; // $v1
		/* end block 1.2 */
		// End offset: 0x800A2034
		// End Line: 223
	/* end block 1 */
	// End offset: 0x800A2124
	// End Line: 256

	/* begin block 2 */
		// Start line: 345
	/* end block 2 */
	// End Line: 346
				UNIMPLEMENTED();
}




